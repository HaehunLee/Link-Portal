<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.link.dao.BlogNeighborDao">		<!-- Dao경로설정 -->
<select id="getNeighborByBlogNo" parameterType="map" resultType="blog">
		select
		a.BLOG_NO no,
		a.BLOG_TITLE title,
		a.BLOG_MAIN_IMG mainImg,
		a.BLOG_THEME theme,
		a.BLOG_VISITS visits,
		a.BLOG_DESCRIPTION description,
		a.BLOG_CREATE_DATE createDate,
		a.USER_ID userId,
		a.BLOG_BACKGROUND_COLOR backgroundColor,
		a.BLOG_FONT_COLOR fontColor,
		a.blog_opacity opacity,
		a.BLOG_ATAG_COLOR atagColor,
		a.BLOG_HR_COLOR hrColor,
		a.BLOG_BODY_COLOR bodyColor,
		a.BLOG_FIRSTCOL firstCol,
		a.BLOG_SECONDCOL secondCol,
		a.BLOG_THIRDCOL thirdCol,
		a.BLOG_LAYOUT layout,
		a.BLOG_PAGENUM_COLOR pageNumColor, 
		a.BLOG_PAGENUM_BACKGROUNDCOLOR pageNumBackgroundColor,
		a.BLOG_TOPIC topic,
		a.BLOG_PAGENUMBORDERCOLOR pageNumBorderColor
	from 
		blog a, blog_neighbor b
	where
		b.blog_no = #{blogNo}
	and
		a.blog_no = b.neighborhood_no
	and 
		b.neighborhood_type = #{type}
</select>
<select id="getNeighborBlogMap" parameterType="int" resultType="map">
	
select row_no, id, nickName, title, categoryNo, boardNo, contents, no, boardMainImg, blogMainImg
from
    (   select ROW_number() over(partition by a.blog_no order by d.board_create_date) row_no,
            c.user_id id,
            c.user_nickname nickName,
            d.board_title title,
            e.category_no categoryNo,
            d.board_no boardNo,
            d.board_contents contents,
            a.BLOG_NO no,
            d.board_main_Img boardMainImg,
            a.blog_main_Img blogMainImg
        from
            blog a, blog_neighbor b, users c, blog_boards d, blog_category e, blog_subcategory f
        where
            b.blog_no = #{value}
        and
            a.blog_no = b.neighborhood_no
        and
            a.user_id = c.user_id
        and
            f.blog_no = a.blog_no
        and
            f.subcategory_no = e.subcategory_no
        and
            e.category_no = d.category_no
        and
            b.neighborhood_type = 'All'
        )
    where
        row_no &lt;= 2
</select>

<select id="isNeighbor" parameterType="map" resultType="int">
	select 
		b.neighborhood_no
	from 
		blog a, blog_neighbor b
	where 
		a.blog_no = b.blog_no
	and 
		a.blog_no = #{myBlogNo}
	and 
		b.neighborhood_no = #{neighborhoodNo}
</select>
<select id="getNeighborRequest" parameterType="int" resultType="map">
	select 
		c.user_id NEIGHBORID, c.user_nickName NICKNAME, d.blog_no NEIGHBORBLOGNO 
	from 
		blog a, blog_neighbor b, users c, blog d
	where
	    a.blog_no = b.neighborhood_no
	and
	    b.blog_no = d.blog_no
	and
	    d.user_id = c.user_id
	and
	    a.blog_no = #{value}
</select>
</mapper>